PHASE CHANGES IN SUBTREE VARIETIES IN RANDOM

RECURSIVE AND BINARY SEARCH TREES

QUNQIANG FENG, HOSAM M. MAHMOUD, AND ALOIS PANHOLZER

Abstract. We study the variety of subtrees lying on the fringe of recursive trees and binary
search trees by analyzing the distributional behavior of Xn,k, which counts the number of subtrees
of size k in a random tree of size n, with k = k(n) dependent on n. Using analytic methods we can
characterize for both tree families the phase change behavior of Xn,k as follows. In the subcritical
case, when k(n)/n  0, we show that Xn,k is (after normalization) asymptotically normally
distributed, whereas in the supercritical case, when k(n)/n  , Xn,k converges to 0. In the
critical case, when k(n) = (n ), we show that if k/n approaches a limit then Xn,k converges in
distribution to a Poisson random variable, whereas if k/n does not approach a finite nonzero limit,
the size oscillates and does not converge in distribution to any random variable. This provides for
recursive trees and binary search trees an understanding of the complete spectrum of phases of Xn,k
and the gradual change from the subcritical to the supercritical phase.

Key words. random trees, recurrence, moments, Riccati equation

AMS subject classifications. 05C05, 60C05, 60F05

1. Introduction. The occurrence of patterns in random objects is an important
area of modern research. The prime example is the interest one may have in the
number of occurrences of a word in a given text, or the occurrence of words of a
certain length in that text. Applications abound in linguistics where one wishes to
analyze grammatical frequencies, or in genetics where one tries to identify genes in
strands of DNA. The equivalent and equally important view in random trees is to find
patterns (which are trees of a certain size or a certain shape) in a given tree generated
randomly. This area has already attracted attention in the recent literature on random
trees (see Flajolet, Gourdon, and Mart nez, 1997, Chyzak, Drmota, Klausner and Kok,
2007+, and Feng, Mahmoud, and Su, 2007). In this paper we investigate this area for
two of the most important random tree models. We look at the number of subtrees
of a certain size on the fringe of random recursive trees, and random binary search
trees.

The random recursive tree is a naturally growing structure that underlies many
stochastic phenomena, such as contagion, and algorithms such as the Union-Find
algorithm. For numerous applications of recursive trees we refer the reader to the
survey in Smythe and Mahmoud (1994). The binary search tree is another naturally
growing structure that underlies many algorithms, such as combinatorial sorting and
searching algorithms and serves well as a data structure that supports fast retrieval of
data. For numerous applications of binary search trees we refer the reader to Knuth
(1998) or Mahmoud (2000).

2. Scope. We consider the variety of sizes that appear on the fringe of trees.
For both classes of random recursive trees and binary search trees we analyze the
random variable Xn,k, which counts the number of subtrees of size k in a random
tree of size n, with both k fixed or k = k(n) dependent on n. For k fixed it was

Department of Statistics and Finance, University of Science and Technology of China, Hefei

230026, China (fengqq@mail.ustc.edu.cn).

Department of Statistics, The George Washington University, Washington, D.C. 20052, U.S.A.

(hosam@gwu.edu).

Institut f ur Diskrete Mathematik und Geometrie, Technische Universit at Wien, Wiedner Haupt-

str. 8-10/104, 1040 Wien, Austria (Alois.Panholzer@tuwien.ac.at).

1

2

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

shown in Feng, Mahmoud, and Su (2007) for recursive trees by using the contraction
method and modeling via P olya urns, and in Flajolet, Gourdon, and Mart nez (1997)
for binary search trees by using analytic techniques, that Xn,k is (after normalization)
asymptotically normal distributed. Furthermore, in Feng, Mahmoud, and Su (2007)
the three phases of Xn,k could be identified for recursive tree by computing explicit
formulas for the first two moments of Xn,k.

To show the characterization of the distributional behavior of Xn,k for k = k(n)
dependent on n obtained in the present paper we utilize analytic methods based on
functional equations for generating functions. Such methods proved to be very ef-
fective in combinatorial analysis.
It is a well accepted folklore that when analytic
methods are applicable, they provide fuller asymptotic expansion (hence better ap-
proximation) than purely probabilistic methods; contrast, for example, the very de-
tailed asymptotic expansion in Panholzer and Prodinger (1998) with the probabilistic
approach in Lent and Mahmoud (1996).

The result we establish for recursive trees is the following.

Theorem 2.1. Let Xn,k be the number of subtrees of size k on the fringe of a

random recursive tree of size n.

(a) In the subcritical case, when k/n  0,

k(k+1)

Xn,k  n
q (2k21)n

k(k+1)2(2k+1)

D N (0, 1).

(b) We are in the critical case when k = (n ).

In the critical case, when

k/n  c > 0,

Xn,k

c2(cid:17),
D Poi(cid:16) 1

and if k/n does not converge to a limit, no limiting distribution exists for
Xn,k.

(c) In the supercritical case, when k/n  ,
D 0.

Xn,k

The analytic method employed for recursive trees extends naturally to binary
search trees, which we include in this paper, and possibly to other tree classes, too,
which we leave for future research. The result we establish for binary search trees is
the following.

Theorem 2.2. Let Xn,k be the number of subtrees of size k on the fringe of a

random binary search tree of size n.

(a) In the subcritical case, when k/n  0,

2n

Xn,k 

(k+1)(k+2)
2k(4k2+5k3)n

(k+1)(k+2)2(2k+1)(2k+3)

D N (0, 1).

q

SUBTREE VARIETIES IN RANDOM TREES

3

(b) We are in the critical case when k = (n ).

k/n  c > 0,

In the critical case, when

and if k/n does not converge to a limit, no limiting distribution exists for
Xn,k.

Xn,k

D Poi(cid:16) 2
c2(cid:17),
(c) In the supercritical case, when k/n  ,
D 0.

Xn,k

We remark that Xn,k can also be interpreted as the number of nodes in a random
tree of size n, which have exactly k descendants (if we assume that a node itself is
counted as its own descendant). From this point of view the counterpart of Xn,k
are the level polynomials Ln,k, i.e., the random variable that counts the number of
nodes in a random tree of size n, which have exactly k ascendants. The distributional
behavior Ln,k, i.e., the number of nodes at level k in a random tree of size n, has been
analyzed recently for recursive trees and binary search trees by Fuchs, Hwang, and
Neininger (2006).

The rest of the paper is organized as follows.

In Section 3 we first give the
definition of random recursive trees, and derive a partial differential equation for the
number of subtrees of a given size (possibly dependent on n). This involves setting up
a basic stochastic recurrence based on a decomposition property of random recursive
trees. In Subsection 3.1 we show how to compute the exact moments. The critical and
supercritical cases fall out directly from the raw moments, as shown in Subsections 3.2
and 3.3. However, the subcritical case needs centering (and scaling) to get a Gaussian
limit. Therefore, to reach the limit distribution via moments, we need to have them
centered. This is done in Subsection 3.4, where several technical subsections are
dedicated to deriving estimates for the centered moments (Subsections 3.4.13.4.4).

Having seen the mechanics of the method applied to recursive trees, the pre-
sentation for binary search trees is brief, and sketched in sections modeled after the
exposition of recursive trees: starting with the definition of random binary search
trees and its partial differential equation in Section 4, then moving on to the exact
moments (Section 4.1). Then we show how to compute the limit distributions in the
critical and supercritical cases (Sections 4.2 and 4.3). The subcritical case is dealt
with in Subsection 4.4, and the string of technical estimates is in Subsections 4.4.1
4.4.5). We conclude in Section 5 with a few remarks on the choice of an analytic
methodology.

2.1. Notation. In the discourse we shall use the following notation. The symbol
[[A]] denotes Iversons bracket for the predicate A, i. e.
[[A]] = 1, if A is true and 0
otherwise. For any number x, and nonnegative integer m, the notation xm stands
for the falling factorial x(x  1) . . . (x  m + 1); we interpret x0 as 1. The notation
n r
so stands for the rth Stirling number (of the second kind) of order s. The operator
For probabilistic convergence we use D to denote convergence in distribution.

[zn] extracts the nth coefficients when applied to a function, that is, [zn]f (z) is the
coefficient of zn in the power series expansion of f (z).

The standard random variables Poi() (the Poisson distributed with parameter )

4

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

and N (, 2) (the normally distributed with mean  and variance 2) appear in the
results as limiting random variables. Other standard nomenclature is employed, and
we assume it is familiar to the reader, and needing no special mention here.

3. The variety of subtree sizes in a recursive tree. The random recursive
tree is an outgrowth from a single node labeled 1. Progressively, nodes are added in
stages: At the nth stage a node in the existing tree is chosen at random as a parent
for the nth entrant (labeled n). In this context random means that all nodes in the
tree of size n 1 are equally likely parents. According to this construction algorithm,
the nodes along any root-to-leaf path carry increasing labels, hence these trees are
also members of the class of increasing trees.

The model of randomness in the growth of random recursive trees induces a uni-
form distribution on the trees: All (n 1)! recursive trees of size n are generated with
equal probability. Many important properties of recursive trees have been analyzed
from the convenient viewpoint of recurrence occurring naturally in the stochastic
growth. Nonetheless, the uniform distribution of the trees also gave rise to analyses
based on generating functions and analytic methods such as integral transforms (see
Bergeron, Flajolet and Salvy (1992)).

Let Xn,k be the number of nodes in a random recursive tree of size n that are
the roots of subtrees of size k. (A subtree rooted at a node is the entire structure of
descendant nodes from the given one.) Equivalently, Xn,k is the number of subtrees
on the fringe of the recursive tree with size k. Our count of the size of a subtree
includes its root. Thus, for example, a leaf roots a subtree of size 1. Applications
of Xn,k include finding out the number of participants in a chain letter scheme, who
will attain a certain profit (see Gastwirth and Bhattacharya, 1984), or the number
of copies of a particular ancient text in a philological study (see Najock and Heyde,
1982).

Mk(z, v) be the moment generating function

We denote by Tn = (n  1)! the number of different recursive trees of size n. Let
Mk(z, v) =Xn1Xm0

vm =Xn1Xm0

P{Xn,k = m}Tn

P{Xn,k = m}

zn
n

vm.

zn
n!

According to the recursive nature of these trees, we can read the probabilities that
the subtrees have certain sizes right off the definition. For all k  1, the probabilities
P{Xn,k = m} satisfy (for n > k)

P{Xn,k = m} =Xr1

1

ni1, 1ir

r! Xn1++nr =n1
 Xm1++mr =m

mi0, 1ir

(cid:18) n  1
n1, . . . , nr(cid:19) Tn1  Tnr
P{Xn1,k = m1} P{Xnr ,k = mr},

Tn

with initial values P{Xk,k = 1} = 1, and P{Xn,k = 0} = 1, for 1  n < k.

Multiply this recurrence by Tn

zn1

(n1)! vm and sum up over n > k and m  0 to

obtain the following functional equation, for k  1,
(3.1)

Mk(z, v) = eMk(z,v) + (v  1)zk1,


z

with initial condition Mk(0, v) = 0.

SUBTREE VARIETIES IN RANDOM TREES

5

It can be easily checked that the function

(3.2)

Mk(z, v) =

(v  1)zk

k

+ log


1
(v1)tk

k

dt


0 e

1 R z

is a solution to the partial differential equation (3.1), that also satisfies the initial
conditions. The solution (3.2) can be found by using the substitution Q(z, v) :=
exp(Mk(z, v)) in (3.1), which leads to a solvable Riccati differential equation.

From the solution (3.2) we can obtain the rth factorial moments, which directly

furnish a limiting distribution for the critical and supercritical cases.

3.1. Exact moments. To get the rth factorial moments we use the substitution

w := v  1 in Mk(z, v), and extract coefficients:

In order to expand Mk(z, 1 + w) around w = 0 we consider

E(cid:0)X r
n,k(cid:1) = E(cid:0)Xn,k(Xn,k  1) (Xn,k  r + 1)(cid:1) = nr! [znwr]Mk(z, 1 + w).
log 

k dt! = log 

j! kj dt!

1
0 e wtk

wj tkj

1

1 R z

1 R z
1
1  z

0 Pj0
+ log 

= log

l

wjzkj

1  z

j! kj (kj+1)!
1zPj1
j! kj(kj + 1)
l 
= [wr]Xl1 (cid:0) z
1z(cid:1)l
Xj1

=Xl1 (cid:0) z
1z(cid:1)l
Xj1++jl=r
i=1 ji!Ql
krQl
Xl=1 (cid:0) z
1z(cid:1)l
kr Xj1++jl=r

i=1 ji!Ql
Ql
1z(cid:1)l
Xl=1 (cid:0) z
(cid:18)
j1, . . . , jl(cid:19)
kr Xj1++jl=r


jq 1, 1ql

jq 1, 1ql

jq 1, 1ql

1
r!

zkr

zkr

zkr

=

=

r

l

l

l

r

r

i=1(jik + 1)

1
i=1(jik + 1)

.

1

i=1(jik + 1)

Ql

1

1

j! kj (kj+1)! ,

wj zkj

j! kj (kj+1)! .

wj zkj

1  z

1zPj1

1  z

1zPj1

and obtain from (3.2):

(3.3)

k

+

wzk

1
1  z

Mk(z, 1 + w) = log

+ log 
Next we extract coefficients and get for r  1:
[wr] log 

wj zkj

1

6

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

This immediately leads from (3.3) to the following formula for the rth coefficients

(r  1):

[wr]Mk(z, v) =

zk
k

[[r = 1]]

(3.4)

+

1
r!

r

Xl=1 (cid:0) z
1z(cid:1)l

l



zkr

kr Xj1++jl=r

jq 1, 1ql

(cid:18)

r

j1, . . . , jl(cid:19)

.

1

i=1(jik + 1)

Ql

The formula (3.4) gives

E(Xn,k) = n[znw]Mk(z, 1 + w)

k

= n[zn](cid:18) zk
= n(cid:16) 1

k

[[n = k]] +

+

zk+1

k(k + 1)(1  z)(cid:19)

1

k(k + 1)

[[n  k + 1]](cid:17),

and thus the following result ensues for the expectation of Xn,k, as given in Feng,
Mahmoud and Su (2007):

(3.5)

E(Xn,k) =


n

k(k+1) ,
1,
0,

for n  k + 1;
for n = k;
for 1  n < k.

Owing to the explicit form of (3.4) we also get the following closed form solution

E(cid:0)X r

for the rth factorial moments with r  2:
n,k(cid:1) = nr![znwr]Mk(z, v)
[[n  kr + 1]]n
Xl=1
(cid:18)
 Xj1++jl=r

jq 1, 1ql

(3.6)

kr

=

r

(cid:18)n  kr  1
l  1 (cid:19)
j1, . . . , jl(cid:19)

r

l

Ql

1

.

i=1(jik + 1)

As an example, we compute the second factorial moment:

E(cid:0)Xn,k(Xn,k  1)(cid:1) =

n(n  2k  1)
k2(k + 1)2 

n

k2(2k + 1)

,

for n  2k + 1,

and is 0 otherwise.

In view of the classical relation

E(cid:0)X r

n,k(cid:1) =

r

Xl=1(cid:26) r

l(cid:27)E(cid:0)X l
n,k(cid:1),

one could also get (at least in principle) closed formulas for every ordinary rth moment.

SUBTREE VARIETIES IN RANDOM TREES

7
3.2. The critical case. We are in the critical case when k = (n ). There
are two flavors within this case: one flavor is when k/n converges to a limit, such
as for example the case k = 3n + log n, the other flavor is when k is asymptotic
to g(n)n with g(n) being a function of bounded variation, but oscillating and not
converging to any limit, such as for example the case k = (2 + sin n)n + 6.
k2  , for some  > 0. It
is evident from (3.5) that we have E(Xn,k)  . Next we consider a fixed r  2. We
split the sum appearing in (3.6) as follows:

Firstly, we consider the critical case having the flavor n

Xj1++jr =r

jq 1, 1qr

r

 (cid:18)n  kr  1
r  1 (cid:19)
{z
(cid:18)n  kr  1
l  1 (cid:19)
Xj1++jl=r

jq 1, 1ql

=:A

l

r

j1,...,jr(cid:1)

i=1(jik + 1)

(cid:0)
Qr

(cid:0)

r

j1,...,jl(cid:1)

i=1(jik + 1)

Ql

}

.

}

=:B

{z

E(cid:0)X r

n,k(cid:1) =

[[n  kr + 1]]n

kr

[[n  kr + 1]]n

+

kr

r1

Xl=1

|

|

For large n we can drop Iversons brackets in both A and B. Using

Xr0 Xj1++jl=r

jq 1, 1ql

we obtain the inequality

r

(cid:18)
j1, . . . , jl(cid:19) zr

r!

= (ez  1)l,

Xj1++jl=r

jq 1, 1ql

r

(cid:18)
j1, . . . , jl(cid:19) = r![zr](ez  1)l  r![zr]elz = lr,

and further by trivial estimates:

B 





=

r1

1

k

rr1

Xl=1

nl
l! krkl lr
r1
kr1l(cid:16) n
k2(cid:17)l
Xl=1
k2 Xl0(cid:0) n
k2(cid:1)l
rr1
k 
rr1 n

l!

n

n

e

k2 ,

k3

1

(l  1)!

Since n

k2  , we further have

B = O(cid:16) 1

k(cid:17) = O(cid:16) 1
n(cid:17).

8

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

The expression A simplifies considerably, since the only possible composition of

r in r integers jq  1 is obtained for j1 =  = jr = 1; thus for large n we have

r!

(k + 1)r

r

n

=

nr

A =

kr  (cid:18)n  kr  1
r  1 (cid:19)

n(cid:17) + O(cid:16) 1
k(cid:17)(cid:17)
k2r(cid:16)1 + O(cid:16) k
k2(cid:17)r(cid:0)1 + O(cid:16) 1
n(cid:17)(cid:17).
=(cid:16) n
k2  , we also get for every r  1:
+ O(cid:16) 1

k2(cid:17)r
n,k(cid:1) =(cid:16) n

E(cid:0)X r

n(cid:17)  r.

Therefore, if n

Since r are the moments of Poi(), and convergence of all moments to a random

variable uniquely characterized by its moments implies weak convergence, we get

Xn,k

D Poi().

, and thus kn  c. When k is of the order n, but fluctuations persist, as

This proves the convergence part of Theorem 2.1 (b), where we used the substitution
c := 1
in the case involving sinusoids mentioned at the beginning of this subsection, all the
moments oscillate, and no limit distribution can exist.

3.3. The supercritical case. We consider the supercritical case in passing, as
it does not require additional effort. Assume that k := kn grows with n such that
n
k2 = o(1).

Crude estimates for (3.6) are sufficient for our purpose. We get for r  2:

E(cid:0)X r

n,k(cid:1) 

nl1

r

r

jq 1, 1ql

l! Xj1++jl=r
krl(cid:16) n
k2(cid:17)l

1
kr

(cid:18)
j1, . . . , jl(cid:19) 1
kl =
(l  1)!  rr1 n

nl
Xl=1
l! kl lr
k2(cid:1)l
k2 Xl0 (cid:0) n

l!

1

1

r

n
kr

Xl=1
Xl=1
 rr1
= rr1 n
k2 e

r

n

k2 .

k2  0, we have that for all r  1: E(cid:0)X r

Since n
of all moments, and subsequently convergence of Xn,k to a degenerate distribution
with mass at 0. Part (c) of Theorem 2.1 is proved. Because the limit is constant, this
convergence is in probability, too.

n,k(cid:1)  0. Again we have convergence

3.4. The subcritical case. For the critical and supercritical cases, it was suf-
ficient to work with raw moments and establish their convergence to the moments
of a known simple distribution. For the subcritical case, we need centering and scal-
ing, too. We appeal to the method of recursive moments (see Chern, Hwang and
Tsai, 2002), although here we are not forced to pump out the behaviour of the
moments in an inductive way, but we are able to obtain exact (but rather involved)

SUBTREE VARIETIES IN RANDOM TREES

9

expression for the moments directly by extracting coefficients of the moment generat-
ing function of the centered random variable. Consider the centered random variable
 Xn,k := Xn,k  E(Xn,k) and introduce the generating function

 Mk(z, s) :=Xn1

 Xn,ks(cid:1) zn
E(cid:0)e

n

=Xn1

eE(Xn,k)sE(cid:0)eXn,ks(cid:1) zn

n

.

Using the explicit formula for E(Xn,k) as given by (3.5) we obtain by routine

manipulations

 Mk(z, s) = Mk(cid:0)e s

k(k+1) z, es(cid:1) +(cid:0)1  e

ks

k+1(cid:1) zk

k

+ X1n<k

zn

n  X1n<k(cid:0)e s

k(k+1) z(cid:1)n

n

.

Plugging in the formula for Mk(z, v) given by (3.2) we further obtain after sim-

plifications:

(3.7)

 Mk(z, s) = log

1 R e
+ X1nk

0

e

1

k(k+1) z

(es1)tk



k(k+1) z(cid:1)n
n  X1nk(cid:0)e s

dt

n

zn

k

 s

.

In the following chain of technical subsections, we analyze the centered moments,
identify the main contribution and put upper bounds on the negligible terms.

 s

k(k+1) z

(es1)tk

k

e

dt around

j! kj(k + 1)j(cid:21)
(1)jsjz
(1)lz
l! kl(k + 1)l(cid:17)

s = 0 and z = 1:

 s

k(k+1) z

3.4.1. Expanding around s = 0. We first expandR e
Z e
=Z e

(es  1)jtkj

(es  1)je s(kj+1)

j! (kj + 1)kj

k(k+1) z

(es1)tk

 s

dt

e

0

0

0

k

k(k+1) zkj+1

Xj0
k(k+1) z +Xj1

= e s

j! kj

dt =Xj0
(es  1)je s(kj+1)

j! (kj + 1)kj

k(k+1) zkj+1

+

m!

k(k+1) zkj+1

j! (kj + 1)kj

j! kj(k + 1)j#
(1)jsjz

= z +Xj1" (es  1)je s(kj+1)
j o j! sm
= z +Xj1"Xmjn m
(1)m(kj + 1)msm
j! (kj + 1)kj Xm0
n lm
j o(1)m(kj + 1)mzkj+1
sl(cid:16) l
= z +Xl1
Xj=1
Xm=0
m! (l  m)! (kj + 1)kj+m(k + 1)m +
n lm
j o(1)m(kj + 1)m
sl(cid:18) l
= z +Xl1
Xj=1
Xm=0

m! (l  m)! (kj + 1)kj+m(k + 1)m

km(k + 1)mm!

zkj+1 +

lj

lj

10

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

kj+1

(1)i(cid:18)kj + 1
Xi=0

sl(cid:16)lk+1
= z +Xl1
Xi=0
(1)i(1  z)i
(1)l

(1)l1
l! kl(k + 1)l (1  z)(cid:17)

i (cid:19)(1  z)i +
Xm=0

(1)l
l! kl(k + 1)l +
n lm
j o(1)m(kj + 1)m(cid:0)kj+1
i (cid:1)
Xj=1
m! (l  m)! (kj + 1)kj+m(k + 1)m
(1)l1
l! kl(k + 1)l (1  z)(cid:17).

l! kl(k + 1)l +

lj

+

l

So, we obtain the following simple structure for the integral considered:

 s

k(k+1) z

(es1)tk

k

e

Z e

0

dt = z +Xl1

sl

lk+1

Xi=0

cl,i(k) (1  z)i,

where the functions cl,i(k) are given by

cl,i(k) = (1)i

l

lj

n lm
j o(1)m(kj + 1)m(cid:0)kj+1
i (cid:1)
Xj=1
Xm=0
m! (l  m)! (kj + 1)kj+m(k + 1)m
(1)l1[[i = 1]]
(1)l[[i = 0]]
l! kl(k + 1)l +
l! kl(k + 1)l

.

+

(3.8)

Next we consider

0

0

1

1

e

k

dt

(es1)tk

 s

k(k+1) z

 s

k(k+1) z

= log

1  1

+ log 

log


1 R e
1
1  z



1zPl1 slPlk+1
and extract coefficients. This gives for r  1:
[sr] log



1 R e
i=0 cl,i(k)(1  z)i!
= [sr] log 
1zPl1 slPlk+1
1  1
[sr]
(1  z)icl,i(k)
1
Xm=1
1  z Xl1
Xi=0


m(1  z)m Xr1++rm=r
Yj=1
Xi=0
Xm=1
Xm=1
rq 1, 1qm Xt1++tm=t

(1  z)t  Xr1++rm=r

(1  z)icrj ,i(k)

m(1  z)m

Xt=0

rq 1, 1qm

0tq rq k+1

m

rj k+1

1
m

r

r

r

rk+m

lk+1

(es1)tk

k

e

dt

sl

1

1

=

=

=

1

m

1

i=0 cl,i(k)(1  z)i! ,

crj ,tj (k),

m

Yj=1

1qm

SUBTREE VARIETIES IN RANDOM TREES

11

and thus

with

[sr] log


fr,p(k) :=

 s

k(k+1) z

0

1 R e
Xm=max{1,p}

r

1

(es1)tk

k

e

dt


 =

rk

Xp=r

fr,p(k)(1  z)p,

1

m Xr1++rm=r

rq 1, 1qm

Xt1++tm=p+m

0tq rq k+1, 1qm

m

Yj=1

crj ,tj (k),

where the functions cl,i(k) are defined by (3.8).

Since

[sr] X1nk(cid:0)e s

k(k+1) z(cid:1)n

n

zn
n

= X1nk

[sr]e sn

k(k+1) = X1nk

zn (1)rnr1
r! kr(k + 1)r ,

we obtain for the coefficients at sr of  Mk(z, s) as given by (3.7), for r  1:

[sr]  Mk(z, s) =

rk

Xp=r

fr,p(k)(1  z)p + X1nk

zn (1)r1nr1
r! kr(k + 1)r ,

which can be written as

[sr]  Mk(z, s) =

r

Xp=1

1

(1  z)p

 fr,p(k) +

rk

Xn=0

gr,n(k)zn,

with

(3.9)

 fr,p(k) := fr,p(k) =

r

Xm=p

for 1  p  r, and

1

m Xr1++rm=r

rq 1, 1qm

gr,n(k) := (1)n

rk

Xp=n(cid:18)p

n(cid:19)fr,p(k) +

Xt1++tm=mp

0tq rq k+1, 1qm

m

Yj=1

crj ,tj (k),

(1)r1nr1
r!kr(k + 1)r [[1  n  k]].

This representation of [sr]  Mk(z, s) immediately leads to the following explicit

formula for the rth moments of  Xn,k, which is valid for n  rk + 1:
 fr,p(k)(cid:18)n + p  1
p  1 (cid:19),

n,k(cid:1) = r! n[znsr]  Mk(z, s) = r! n

E(cid:0)  X r

Xp=1

(3.10)

r

where the functions  fr,p(k) are given by (3.9).

We now examine the functions cl,i(k) as given by (3.8). Using the identity

l

Xm=j(cid:18) l

m(cid:19)(cid:26) m

j (cid:27) =(cid:26) l + 1
j + 1(cid:27),

12

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

we get by very crude estimates:

(1)i

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

l

lj

l

l

Xj=1
Xm=0
Xj=1

Xj=1
Xj=1
Xj=1





=

l

l

lj

lj

(kj + 1)kj

ki(j + 1)i
l! i! kj+1

Xm=0
Xm=0

n lm
j o(1)m(kj + 1)m(cid:0)kj+1
m! (l  m)! (kj + 1)kj+m(k + 1)m(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)
i (cid:1)
n lm
j o(kj + 1)m
(cid:0)kj+1
i (cid:1)
m! (l  m)! km(k + 1)m
n lm
j o(j + 1)m(cid:0) l
m(cid:1)
Xm=0(cid:18) l
m(cid:19)(cid:26) l  m
j (cid:27)
(cid:26) l + 1
j + 1(cid:27)
Xj=2(cid:26) l + 1
j (cid:27)

ki(j + 1)i(j + 1)lj

ki(j + 1)i(j + 1)lj

(k + 1)m

l! i! kj+1

l! i! kj+1

l! i! k2

lj

l+1

ki(l + 1)i(l + 1)l1

(3.11)





(l + 1)lBl+1

(l + 1)! 

(l + 1)i

i!

ki2,

where Bl denote the Bell numbers (number of partitions of a set with l elements).
Since

(cid:12)(cid:12)(cid:12)(cid:12)

(1)l

kl(k + 1)ll!(cid:12)(cid:12)(cid:12)(cid:12) 

1
k2 =

1

k2(cid:26) l + 1
1 (cid:27),

we can add this summand in the preceding computations at step (3.11) and thus get
the same bound. Therefore, we arrive at the following bound, which holds uniformly
for all l, i and k:

|cl,i(k)|  ql,iki2,

with

ql,i :=

(l + 1)lBl+1

(l + 1)! 

(l + 1)i

i!

.

The two functions that exert the most influence on the asymptotic distribution

cl,i(k), and which can be computed easily from (3.8), are

c1,0(k) =

c2,0(k) =

1

k(k + 1) 
(k)

,

2

with

1

k(k + 1)

= 0,

(k) :=

2k2  1

k(k + 1)2(2k + 1)

.

3.4.2. Estimates for  fr,p(k). We next treat the functions  fr,p(k) as given
by (3.9). Since 1  p  r holds in (3.10), this implies that in the compositions
appearing in the definition of  fr,p(k) we always have rq, tq  r for all 1  q  m.
Thus, we obtain the following estimate, which holds for all 1  p  r and all rq, tq:

|crj ,tj (k)|  qrj ,tj ktj2  crktj2,

SUBTREE VARIETIES IN RANDOM TREES

13

with the universal constant

(3.12)

cr :=

(r + 1)2rBr+1

(r + 1)!

.

This gives for 1  p  r the estimate

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

m

crj ,tj (k)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

crktj2

1

m

= cm

rq 1, 1qm

rq 1, 1qm

rq 1, 1qm

0tq rq k+1, 1qm

0tq rq k+1, 1qm

Yj=1
Yj=1

Xt1++tm=mp
Xt1++tm=mp

Xr1++rm=r
 Xr1++rm=r
r kpm Xr1++rm=r
r kpm Xr1++rm=r
 cm
1  z(cid:19)m
r kpm[zr](cid:18) z
r kpm(cid:18)r  1
r (cid:18)2m  2
 cm

Xt1++tm=mp
rq 1, 1qm Xt1++tm=mp
[zmp](cid:18) 1
p  1(cid:19)(cid:18)2m  p  1
m  1 (cid:19)
m  1(cid:19)kpm,

m  1(cid:19)(cid:18) r  1

= cm

= cm

tq 0, 1qm

1

0tq rq k+1, 1qm

1  z(cid:19)m

m

crj ,tj (k)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

r

1

r

r

r

1

cm

1
m

rq 1, 1qm

0tq rq k+1, 1qm

Xt1++tm=mp
Yj=1
m  1(cid:19)kpm
m  1(cid:19)(cid:18) r  1
kp+m =(cid:18)2r  2
Xm=p
1
k2p r.

m Xr1++rm=r
Xm=p
r (cid:18)2m  2
Xm=p

(cid:18)2r  2
r  1(cid:19)(r  1)! cr
(cid:18)2r  2
r  1(cid:19)(r  1)! cr
 fr,p(k)(cid:12)(cid:12)(cid:12)  r
(cid:12)(cid:12)(cid:12)
r  1(cid:19)r! cr
r :=(cid:18)2r  2

1
k2p ,

r.

r

and further

(cid:12)(cid:12)(cid:12)

 fr,p(k)(cid:12)(cid:12)(cid:12) =(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

with

r  1(cid:19)(r  1)! cr

r

1
k2p

1
kq

rp

Xq=0

Thus, we obtain the following estimate, which holds for all 1  p  r and r, k  1:

The constants cr appearing here are given by (3.12).

14

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

3.4.3. Cancelation of  fr,p(k). We shall demonstrate that the functions  fr,p(k)
as defined by (3.9) satisfy  fr,p(k) = 0 for all p   r
2 + 1. We will do this by simply
showing that for every composition m, r1, . . . , rm, t1, . . . , tm of r and m  p respec-
tively there exists a factor c1,0(k), which is zero, and thus the productQm
j=1 crj ,tj (k)
vanishes.
2 + 1. This implies then by (3.9) that also m   r
2 + 1. We
consider now an arbitrary but fixed composition m, r1, . . . , rm, t1, . . . , tm with rq  1
and tq  0, such that r1 +  + rm = r and t1 +  + tm = m  p. We define the sets
T = {q : tq = 0} and R = {q : rq = 1}. Then the relations

Let us take p   r

|T|  m  (m  p) = p,

and

|R|  2m  r

r + 1 > r, which is a contradiction to the choice of rq and tq.

hold. Otherwise, if |T|  p  1 this would implyPm
|R|  2m  r  1 this would imply Pr
get by a simple application of the inclusion-exclusion-principle for p   r
estimate
|R  T| = |R| + |T|  |R  T|  2m  r + p  m = m + p  r  2j r

q=1 tq  m  p + 1 > m  p, and if
q=1 rq  (2m  r  1) + 2(m  (2m  r  1)) =
Next we consider the set R  T = {q : tq = 0  rq = 1}. Since |R  T|  m, we
2 + 1 the
2k  r + 2  1.

The latter equation guarantees that in every composition there exists a number q,
such that rq = 1 and tq = 0, and consequently there is always a factor c1,0(k) = 0 in

every product Qm

j=1 crj ,tj (k). Hence, we have

 fr,p(k) = 0,

for p j r

2k + 1.

We also consider the special case r = 2d and p = d, i. e. we examine

 f2d,d(k) =

2d

Xm=d

1

m Xr1++rm=2d

rq 1, 1qm

Xt1++tm=md

0tq rq k+1, 1qm

m

Yj=1

crj ,tj (k).

If m  d + 1, we can show by arguments as above that there always exists a factor
c1,0(k) = 0 in every product Qm
j=1 crj ,tj (k). Thus all summands with m  d + 1 are
zero. This gives

 f2d,d(k) =

1

d Xr1++rd=2d

rq 1, 1qd

Xt1++td=0

0tq rq k+1, 1qd

d

Yj=1

crj ,tj (k) =

1

d Xr1++rd=2d

rq 1, 1qd

crj ,0(k).

d

Yj=1

Now, since c1,0(k) = 0, we see that the only non-zero contribution is obtained if
r1 =  = rd = 2, which implies

 f2d,d(k) =

1
d

cd
2,0(k) =

d(k)
d2d ,

with (k) =

2k21

k(k+1)2(2k+1) .

SUBTREE VARIETIES IN RANDOM TREES

15

3.4.4. Asymptotics of the centered moments. Summarizing the results of
the previous subsections we have for r  1 that for all n  rk + 1 the rth centered
moments are given by

with

E(cid:0)  X r

n,k(cid:1) = r! n

 r
2 

Xp=1

 fr,p(k)(cid:18)n + p  1
p  1 (cid:19),

|  fr,p(k)| 

r
k2p ,

and

 f2d,d(k) =

d(k)
d2d .

critical case, i. e.
enough, such that (d1)2

We are now going to evaluate the centered moments asymptotically for the sub-
k2
n = o(1); thus we may always assume that we choose n large
n  1 and k2

n  1

2 are satisfied.
We consider the case r = 2d with d  1, which gives
Xp=1
E(cid:0)  X 2d

n,k(cid:1) = (2d)!

(n + d  1)d1n

d(k)
d2d 

d1

+

(2d)!

(d  1)!
d! 2d d(k)nd(cid:0)1 + R(n, k)(cid:1),

=

with

(2d)!  f2d,p(k)(cid:18)n + p  1
p  1 (cid:19)n

We obtain the simple estimate

R(n, k) :=

d1

Yj=1(cid:16)1 +

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

d1

Yj=1(cid:0)1 +
n(cid:17)  1(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

j

j

n(cid:1)  1 +

d1

Xp=1

2dd!  f2d,p(k)

d(k)nd1 (cid:18)n + p  1
p  1 (cid:19).

j

n(cid:17)  1 (cid:0)1 +
(d  1)2

e

 1

d  1
n (cid:1)d1

(d1)2

n

n

d1

=

(d1)2

Yj=1(cid:16)1 +
 e
n  1 


(d  1)2e

n

.

Using the trivial bounds

1
12k2  (k) 

1
k2 ,

which hold for all k  1, we obtain the following estimates:

2dd!  f2d,p(k)(cid:18)n + p  1
p  1 (cid:19)

d(k)nd1

d1

Xp=1

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)

d1

 2dd! 2d

Xp=1
 2dd! 2de

(d1)2

n

np1Qp1

j=1(cid:0)1 + j
n(cid:1)

d(k)nd1k2p

1

ndpd(k)k2p

d1

Xp=1

16

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

12dk2d
ndpk2p

 2dd! 2de

d1

Xp=1

= (24)dd! 2de

k2
n

 (24)dd! 2de

d2

Xq=0(cid:16) k2
n(cid:17)q
1  k2

1

n

k2
n 
k2
n

.

 2e(24)dd! 2d
Combining these estimates yields in the subcritical case:

|R(n, k)| 

(d  1)2e

n

+ 2e(24)dd! 2d

k2
n

= o(1),

and further

We have to consider also the case r = 2d + 1 with d  0, which gives

n,k(cid:1) 
E(cid:0)  X 2d
n,k (cid:1)(cid:12)(cid:12)(cid:12) =(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)
(cid:12)(cid:12)(cid:12)E(cid:0)  X 2d+1

(2d)!

d

d

d

j

(d1)2

n

np

p1

(2d + 1)! n

2d+1
k2p

 (2d + 1)!

,

for d  1.

2dd!(cid:0)(k)n(cid:1)d
Xp=1
Xp=1
 (2d + 1)! 2d+1e

p  1 (cid:19)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)
 f2d+1,p(k)(cid:18)n + p  1
n(cid:17)
Yj=1(cid:16)1 +
(p  1)!
Xp=1(cid:16) n
k2(cid:17)p
Xq=0(cid:16) k2
n(cid:17)q
k2(cid:17)d
 (2d + 1)! 2d+1e(cid:0) n
 (2d + 1)! 2d+1e(cid:16) n
k2(cid:17)d
1  k2
 2e(cid:2)(2d + 1)!(cid:3)2d+1(cid:16) n
k2(cid:17)d
 2e(12)d(cid:2)(2d + 1)!(cid:3) 2d+1(cid:0)(k)n(cid:1)d
n,k (cid:1) = O(cid:0)((k)n)d(cid:1),
for d  0.

d1

1

n

,

and thus

Therefore, considering

E(cid:0)  X 2d+1

with (k) =

 Xn,k

Xn,k  E(Xn,k)

,

=

p(k)n
k(k+1)2(2k+1) , we have for k = o(n ):

2k21

p(k)n
p(k)n(cid:17)2d! 
E (cid:16)  Xn,k

(2d)!
d! 2d ,

for d  1,

SUBTREE VARIETIES IN RANDOM TREES

17

and

p(k)n(cid:17)2d+1! = O 
E (cid:16)  Xn,k

1

p(k)n! = O(cid:0) k

n(cid:1)  0,

 Xn,k(k)n

for d  0.

For the subcritical case the moments of

converge to the moments of a standard

normal distribution, which proves the convergence

k(k+1)

Xn,k  n
q (2k21)n

k(k+1)2(2k+1)

D N (0, 1).

Part (a) of Theorem 2.1 has been established.

4. The variety of subtree sizes in binary search trees. A binary search
tree is constructed from the permutation (1, . . . , n) of the set {1, 2, . . . , n} by the
following algorithm. The first element of the permutation is inserted in an empty tree,
a root node is allocated for it. A subsequent element j (with j  2) is directed to
the left subtree if j < 1, otherwise it is directed to the right subtree. In whichever
subtree j goes, it is subjected to the same insertion algorithm recursively, until it
is inserted in an empty subtree, in which case a node is allocated for it and linked
appropriately as a left (right) child if its rank is less than (at least as much as) the
value of the last node on the path.

Several models of randomness are in common use on binary trees. The uniform
model in which all trees are equally likely has been proposed for applications in formal
languages, compilers, computer algebra, etc. (see Kemp (1984)). However, for the
searching and sorting algorithms alluded to the random permutation model is consid-
ered to be more appropriate. In this model of randomness we assume that the tree is
built from permutations of {1, . . . , n}, where a uniform probability model is imposed
on the permutations instead of the trees. When all n! permutations are equally likely
or random, binary search trees are not equally likely. Several permutations give rise
to the same tree, favoring shorter and well balanced trees rather than scrawny and tall
shapes, which is a desirable property in searching and sorting algorithms (see Mah-
moud (1992)). The term random binary search tree will refer to a binary search tree
built from a random permutation. The random permutation model is not restrictive,
as it covers a rather wide variety of instances, such as when the input is a sample
drawn from any continuous probability distribution, and the construction algorithm
is concerned only with the ranks of the keys, not their actual values.

Let Xn,k be the random variable that counts the number of subtrees of size k on
the fringe of a random binary search tree of size n, and let Mk(z, v) be its generating
function

Mk(z, v) =Xn1Xm0

P{Xn,k = m}znvm.

The binary dichotomy of the ranks in the permutation (relative to the first element)
preserves the probabilistic structure in the conditionally independent subtrees. For
all n > k  1 the probabilities P{Xn,k = m} satisfy the following recurrence:
P{Xn1,k = m1}P{Xn2,k = m2},

P{Xn,k = m} =

1

n Xn1+n2=n1

m1+m2=m

m1 ,m20,n1 ,n20

18

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

with initial values P{Xk,k = 1} = 1, and P{Xn,k = 0} = 1, for 1  n < k. After
multiplication with nzn1vm and summing up over n > k and m  0, we obtain a
functional equation for the generating function and find


z

Mk(z, v) =(cid:0)1 + Mk(z, v)(cid:1)2
for k  1, with initial condition Mk(0, v) = 0.

+ (v  1)kzk1,

Substituting Qk(z, v) := Mk(z, v) + 1 we obtain the Riccati differential equation


z

Qk(z, v) = Q2

k(z, v) + (v  1)kzk1,

Qk(0, v) = 1.

The solution to this differential equation already appears in Flajolet, Gordon and
Mart nez (1997). Using this solution we obtain a representation for our generating
function:

(4.1)

Mk(z, v) = 1
1 +Xj1
1  z Xj1

+

j(k)(v  1)jz(k+1)j Xj1
j(k)(v  1)jz(k+1)j+1 +Xj1

j(k)(v  1)jz(k+1)j1

j(k)(v  1)jz(k+1)j

,

with the functions

(4.2)

(4.3)

where

j(k) = j,1,0(k),
j(k) = j,1,1(k),

j(k) = j,1,0(k),
j(k) = j,1,1(k),

j,m,s(k) =

(1)jkj((k + 1)j + [[s = 1]])s
Qj
i=1[(ik + i)(ik + i + m)]

.

4.1. The fac to rial moments for bi nary search trees. From the solu-
tion (4.1) we can obtain the rth factorial moments, which lead directly to the limiting
distribution for the critical and supercritical cases.

To get the rth factorial moments we use the substitution w := v  1 in Mk(z, v)
and expand this function in powers of w. Straightforward computations leads then to
the following expression:

Mk(z, 1 + w) = 1 +

1

1  z(cid:16)1 +Xj1
Xl0(cid:16) z
1  z Xj1

wj(cid:0)j(k)z(k+1)j  j(k)z(k+1)j1(cid:1)(cid:17) 
wj(cid:0)j(k)z(k+1)j  j(k)z(k+1)j1(cid:1)(cid:17)l

.

Extract coefficients of wr in Mk(z, 1 + w) eventually gives for r  1:

[wr]Mk(z, 1 + w)

=

z(k+1)r

(1  z)r+1(cid:0)1(k)z  1(k)(cid:1)r

SUBTREE VARIETIES IN RANDOM TREES

19

r1

+z(k+1)r

l

1

ji1

r1

(1  z)l+1 Xj1++jl=r
Yi=1(cid:0)ji(k)z  ji(k)(cid:1)
Xl=1
Xl=1
Xj=1(cid:0)j(k)z  j(k)(cid:1)
Yi=1(cid:0)ji(k)z  ji(k)(cid:1) +

(1  z)l+1
z(k+1)r1

1  z

rj

1

l

+z(k+1)r1

 Xj1++jl=rj

ji1

(cid:0)r(k)z  r(k)(cid:1).

Using

r

(cid:0)1(k)z  1(k)(cid:1)r

=(cid:0)1(k)  1(k)(cid:1)r
Xm=1(cid:18) r
m(cid:19)(1)m(cid:16)

(1z)+1 = (cid:0)n+
and analogous expansions, and [zn]
pression also around z = 1 and get the following formula for the rth factorial moment
of Xn,k, which is valid for all n  (k + 1)r and r  1:

+(cid:0)1(k)  1(k)(cid:1)r
1(k)  1(k)(cid:17)m
n (cid:1), we can expand the above ex-

(1  z)m,

1(k)

1

2(cid:17)r+1p

(cid:19)(cid:18) r
p  1(cid:19)(cid:16) k
(1)l+1p

l

1

r

ji1

r

+r!

(k + 1)(k + 2)(cid:17)r

= r! [znwr]Mk(z, 1 + w)
2

p  1
r1
Xl=max(1,p1)

Xp=1(cid:18)n  (k + 1)r + p  1

p  1
Yi=1(cid:0)ji(k)  ji(k)(cid:1)

E(cid:0)X r
n,k(cid:1)
r (cid:19)(cid:16)
= r!(cid:18)n  kr
(k + 1)(k + 2)(cid:17)r
+r!(cid:16)
Xp=1(cid:18)n  (k + 1)r + p  1
(cid:19)
 Xj1++jl=r
jiq (k)  jiq (k)(cid:17)
Yq=1 (cid:16)
X1i1<<il+1pl

(cid:19) min(r+1p,r1)
Xp=1(cid:18)n  (k + 1)r + p
Xj=1
p  1
Xl=max(1,p1)
(1)l+1p Xj1++jl=rj
X1i1<<il+1pl
Xp=1(cid:18)n  (k + 1)r + p

jiq (k)  jiq (k)(cid:17)
Xj=1

Yq=1 (cid:16)
(cid:19) min(rp,r1)

p  1

jiq (k)

jiq (k)

l+1p

l+1p

r!

j(k)

+ r!

r1





rj

ji1

r

l

(cid:0)j(k)  j(k)(cid:1)
Yi=1(cid:0)ji(k)  ji (k)(cid:1)

20

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

rj



Xl=max(1,p)
 X1i1<<ilpl

(1)lp Xj1++jl=rj

ji1

l

Yi=1(cid:0)ji(k)  ji (k)(cid:1)

lp

Yq=1(cid:16)

jiq (k)

jiq (k)  jiq (k)(cid:17) + r!(cid:0)r(k)  r(k)(cid:1).

(4.4)

This yields in particular to results for the expectation and the variance:

(4.5)

E(Xn,k) =

V(Xn,k) =

2(n + 1)

(k + 1)(k + 2)

,

for n  k + 1,

2k(4k2 + 5k  3)(n + 1)

(k + 1)(k + 2)2(2k + 1)(2k + 3)

,

for n  2(k + 1).

4.2. The critical case. We consider the critical case and assume that k := kn

grows with n such that n

k2  , for some  > 0.

Finding the limiting distribution requires some estimates on the functions appear-
ing in (4.4). Using the definition of j(k), j(k), j(k) and j(k) given by (4.2)(4.3)
the following estimates, which hold for all k  2 and j  1, are not hard to show:

(4.6)

(4.7)

|j(k)  j(k)| 

|j(k)  j(k)| 

2
kj+1 ,
3
kj ,

(cid:12)(cid:12)(cid:12)(cid:12)

j(k)

j(k)  j(k)(cid:12)(cid:12)(cid:12)(cid:12)  4jk,

1
kj1 .

|j(k)| 

We can now deduce the asymptotic behavior of the rth factorial moments of Xn,k
by inspecting the summands of (4.4). Considering a fixed r  1 we trivially obtain
for the first summand:

2

r!(cid:18)n  kr

r (cid:19)(cid:18)

(k + 1)(k + 2)(cid:19)r

k2(cid:19)r(cid:16)1 + O(cid:16) 1
=(cid:18) 2n
k(cid:17) +(cid:16) k
n(cid:17)(cid:17)
= (2)r(cid:16)1 + O(cid:16) 1
n(cid:17)(cid:17).
for fixed r  1 by using (4.6) and (4.7), which finally gives

Let us denote by B the remaining summands of (4.4). They can then be estimated

|B| = O(cid:16) 1

k(cid:17) = O(cid:16) 1
n(cid:17).

Summarizing, we obtain for all r  1 and sequences (n, k) such that n

k2   the

following asymptotic expansion:

E(cid:0)X r

n,k(cid:1) = (2)r(cid:16)1 + O(cid:16) 1

n(cid:17)(cid:17).

This shows convergence in distribution of Xn,k to a Poisson random variable with pa-
rameter 2. Thus we proved the convergence asserted in Theorem 2.2 Part (b), where
we used the substitution c := 1
kn  c. When we have a critical case
with k/n not converging to a limit, all factorial (and ordinary) moments oscillate,
and no limit distribution exists for Xn,k.

, and thus

SUBTREE VARIETIES IN RANDOM TREES

21

4.3. The supercritical case. Again by using the estimates (4.6) and (4.7) one
k2 = o(1) under the natural restriction n > k. Thus, we

can show E(Xn,k)  0, for n
have convergence of Xn,k to a degenerate distribution with mass at 0.

4.4. The subcritical case. We consider the centered random variables  Xn,k :=

Xn,k  E(Xn,k) and introduce the generating function

 Mk(z, s) :=Xn1

 Xn,ks(cid:1)zn =Xn1
E(cid:0)e

eE(Xn,k)sE(cid:0)eXn,ks(cid:1)zn.

Using the explicit formula for E(Xn,k) as given by (4.5) we obtain

 Mk(z, s) = e

2s

(k+1)(k+2) Mk(cid:0)e
+ X1n<k

zn  X1n<k

2s

(k+1)(k+2) z, es(cid:1) + (1  e

e 2(n+1)s

(k+1)(k+2) zn,

which further leads by using (4.1) and (4.2)(4.3) to:

 Mk(z, s) =

with the expressions

2s

e

(k+1)(k+2) U

V

+ X1n<k

 e
zn  X1n<k

2s

(k+1)(k+2) + (1  e
e 2(n+1)s

(k+1)(k+2) zn,

ks

k+2 )zk

ks

k+2 )zk

U := 1 +Xj1
Xj1
V := 1  e
+Xj1

k+2 z(k+1)j

j(k)(es  1)je 2js
j(k)(es  1)je 2((k+1)j1)s
(k+1)(k+2) z Xj1
j(k)(es  1)je 2js

2s

(k+1)(k+2) z(k+1)j1,

(k+1)(k+2) z(k+1)j+1

j(k)(es  1)je 2((k+1)j+1)s
k+2 z(k+1)j.

4.4.1. Expanding around s = 0. We expand  Mk(z, s) around s = 0 and
z = 1. It is straightforward, though rather laborious, to come up with the following
representation:

Mk(cid:0)e

2s

(k+1)(k+2) z, es(cid:1) = 1 +

Pl0 slPl(k+1)

i=0

dl,i(k)(1  z)i

cl,i(k)(1  z)i

where the functions dl,i(k) and cl,i(k) are given as follows:

dl,i(k) = (1)i

l

i=0

1  z Pl1 slPl(k+1)+1
j!n lm
j o(1)m
Xj=1
m! (l  m)! (k + 2)m
(cid:18)(cid:18)(k + 1)j  1
(cid:19)(cid:16)(2j)mj(k) 

Xm=0

lj

i

(2((k + 1)j  1))mj(k)

(k + 1)m

,

(cid:17)

22

(4.8)

d0,0(k) = 1,

cl,i(k) = (1)i

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

for l  1,

l

lj

+(cid:18)(k + 1)j  1
(cid:19)(2j)mj(k)[[i  1]](cid:19) ,
i  1
n lm
j oj!(1)m
m! (l  m)! (k + 2)m
(cid:19)(cid:16) (2((k + 1)j + 1))mj(k)
i  1 (cid:19) (2((k + 1)j + 1))mj(k)

Xj=1
(cid:18)(cid:18)(k + 1)j

Xm=0

(k + 1)m

+(cid:18)(k + 1)j
(1)l2l

i

 (2j)mj(k)(cid:17)
[[i  1]](cid:19)
l!(k + 1)l(k + 2)l [[i = 1]].

(1)l2l

(k + 1)m

l!(k + 1)l(k + 2)l [[i = 0]] 

(4.9)

+

Thus,  Mk(z, s) can be written as

 Mk(z, s) =

(4.10)

e

2s

i=0

(k+1)(k+2)(cid:16)Pl0 slPl(k+1)
1  z Pl1 slPl(k+1)+1
k+2 )zk + X1n<k
+(1  e

dl,i(k)(1  z)i(cid:17)
cl,i(k)(1  z)i  e
zn  X1n<k
e 2(n+1)s

i=0

ks

(k+1)(k+2) zn.

2s

(k+1)(k+2)

The only interesting part in equation (4.10) is the first summand, since the remaining
summands do not give a contribution for n > k (the remainder is a polynomial in z
of degree k). The first summand of (4.10) can be expanded around s = 0 and z = 1
and finally leads for r  1 to the following representation:
dl,i(k)(1  z)i(cid:17)
cl,i(k)(1  z)i
1
(1  z)p+1 gr,p(k) +

(k+1)(k+2)(cid:16)Pl0 slPl(k+1)
1  z Pl1 slPl(k+1)+1
(1  z)p+1 fr,p(k) +

hr,p(k)zp,

r(k+1)1

i=0
r1

[sr]

e

i=0

=

1

2s

r

Xp=0

Xp=0

Xp=0

with

(4.11)

fr,p(k) =

gr,p(k) =

(4.12)

r

m

r

rq 1

rc

0tq rq (k+1)+1

crj ,tj (k),

Xm=p Xr1++rm=r
Xt1++tm=mp
Xa=p(cid:16) rc
Xm=a Xr1++rm=rc
Xc=1



Yj=1
crj ,tj (k)(cid:17)
Xt1++tm=ma
Yj=1
(k + 1)cb(k + 2)cb(c  b)!
(1)cb2cbdb,ap(k)


Xb= ap

0tq rq (k+1)+1

k+1 

rq 1

m

c

,

and certain functions hr,p(k), which are of course irrelevant for our purpose.

This leads also to the required representation

[sr]  Mk(z, s) =

r

Xp=0

1

(1  z)p+1 fr,p(k) +

r1

Xp=0

1

(1  z)p+1 gr,p(k) +

r(k+1)1

Xp=0

 hr,p(k)zp,

SUBTREE VARIETIES IN RANDOM TREES

23

where the functions fr,p(k) and gr,p(k) are defined by (4.11) and (4.12). The functions
 hr,p(k) are irrelevant and thus not given explicitly.

The representation in the last display gives the following explicit formula for the

rth moments of  Xn,k, which is valid for n  r(k + 1):

E(cid:0)  X r

n,k(cid:1) = r! [znsr]  Mk(z, s) = r!

r

Xp=0(cid:18)n + p

p (cid:19)fr,p(k) + r!

r

Xp=0(cid:18)n + p

p (cid:19)gr,p(k),

where the functions fr,p(k) and gr,p(k) are given by (4.11) and (4.12).

4.4.2. Estimates for cl,i(k) and dl,i(k). One obtains easily the following esti-

mates of the functions cl,i(k) and dl,i(k) given by (4.8) and (4.9):

|dl,i(k)|  2l2(2l)2l+1Bl(2l)iki1,
|cl,i(k)|  Bl22l+3ll+3(2l)iki2,
Moreover, we have the following values:

for l  1, i  0, k  1,
for l  1, i  0, k  1.

with

c1,0(k) = 0,

and

c2,0(k) =

(k)

2

,

(k) :=

2k(4k2 + 5k  3)

(k + 1)(k + 2)2(2k + 1)(2k + 3)

.

4.4.3. Estimates for fr,p(k) and gr,p(k). It is possible to give suitable esti-
mates on the growth of fr,p(k) and gr,p(k): There exist constants r and r (depending
only on r), such that

|fr,p(k)|  r

1
k2p ,

and

|gr,p(k)|  r

1

k2p+2 ,

for all 0  p  r (respectively 0  p  r  1) and k  1.

For instance one can choose the constants

r =

(2r  1)! (r + 1)

r!

cr
r,

with

r = 2r+2(cid:18)2r  1

r  1(cid:19)r! rcr

r dr,

cr := Br22r+3rr+3(2r)r,

and

dr := 2Brrr(2r)3r+1.

4.4.4. Cancelation of  fr,p(k). Using the same combinatorial argumentation

as made for recursive trees we can show:

fr,p(k) = 0,

gr,p(k) = 0,

Furthermore, one can show

for p j r
2k + 1;
2m.
for p l r

f2d,d(k) = cd

2,0(k) =

d(k)

2d

.

24

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

4.4.5. Asymptotics of the centered moments. In view of the development

in subsection 4.4.3 we obtain the explicit formulas for the rth moments of Xn,k:

E(cid:0)  X 2d

+

d1

n,k(cid:1) = (2d)!(cid:18)(cid:18)n + d
d (cid:19)f2d,d(k)
Xp=0(cid:18)n + p
p (cid:19)(cid:0)f2d,p(k) + g2d,p(k)(cid:1)(cid:19),
Xp=0(cid:18)n + p
p (cid:19)(f2d+1,p(k) + g2d+1,p(k)),
n  0,

n,k (cid:1) = (2d + 1)!

d

Using the previous estimates we can easily show that, for k2

E(cid:0)  X 2d+1

d  1,

d  0.

(2d)!
d! 2d ndd(k),

n,k(cid:1) 
E(cid:0)  X 2d
n,k (cid:1) = O(cid:16)(cid:16) n
E(cid:0)  X 2d+1

k2(cid:17)d(cid:17) = O(cid:0)ndd(k)(cid:1).

Therefore, considering

with (k) =

(k+1)(k+2)2(2k+1)(2k+3) , we have for k = o(n):

2k(4k2+5k3)

 Xn,k

Xn,k  E(Xn,k)

,

=

p(k)n

p(k)n
p(k)n(cid:17)2d! 
E (cid:16)  Xn,k
p(k)n(cid:17)2d+1! = O(cid:0) k
E (cid:16)  Xn,k

(2d)!
d! 2d ,
n(cid:1)  0,

for d  1,

for d  0.

Whence, for the subcritical case we have

2n

Xn,k 

(k+1)(k+2)
2k(4k2+5k3)n

(k+1)(k+2)2(2k+1)(2k+3)

D N (0, 1),

q

completing the proof for the subcritical case (Part (a) of Theorem 2.2).

5. Concluding remarks. Several methods have recently come into the reper-
toire of the analysis of algorithms, and there is a question of the choice when it
comes to an analysis like the one we conducted in this investigation. For example,
the contraction method (introduced in R osler, 1991), P olya urns (Johnson and Kotz,
1977), the Chen-Stein method (Barbour, Holst, and Janson ,1992), methods for ad-
ditive functions in subtrees (Devroye, 1991 and Devroye, 2003) are all attractive for
this kind of analysis. These methods have been used successfully in the analysis of
algorithms, (see for example Neininger, 2002, or R osler and R uschendorf, 2001 for
applications of the contraction method). However, Experience shows that several of
these methods will work with ease in some of the phases, but not systematically across
all the phases. For instance, in our multi-phase problem P olya urns work well in the

SUBTREE VARIETIES IN RANDOM TREES

25

very low range (small fixed k), as was attempted in Feng, Mahmoud and Su (2007).
The difficulty in this method is that one needs a detailed description of the fringe in
terms of urns that are different from each other for each k, and that become more
complex as k increases. As for the contraction method , again it can be used in the
case of small fixed k, but does not lend itself easily to k = kn   in the subcritical
case when k increases but at rate slower than n. The difficulty stems from com-
plicated toll functions. It is not clear how to apply the contraction method in the
critical case. The same applies to the other methods above. It is our experience that
the analytic methods, based on generating functions, are systematic enough to cover
all the ranges.

Acknowledgment. The work of the first author (Q. Feng) is supported by the
National Natural Science Foundation of China (Grant No. 10371117) and the Special
Foundation of USTC. The work of the third author (A. Panholzer) is supported by
the Austrian Science Foundation FWF (Grant No. S9608-N13).

REFERENCES

[1] Barbour, A., Lars Holst, L. and Janson S. (1992). Poisson Approximation. Oxford University

Press.

[2] Bergeron, F. Flajolet, P. and Salvy, B. (1992). Varieties of increasing trees. Lecture Notes in

Computer Science, 581, 2448. Springer, Berlin.

[3] Chern, H., Hwang, H. and Tsai, T. (2002). An asymptotic theory for Cauchy-Euler differential
equations with applications to the analysis of algorithms. Journal of Algorithms, 44, 177
225.

[4] Chyzak, F., Drmota, M., Klausner, T. and Kok, G. (2007+). The distribution of patterns in

random trees, Combinatorics, Probability and Computing, to appear.

[5] Devroye, L. (1991). Limit laws for local counters in random binary search trees. Random Struc-

tures and Algorithms, 3, 303315.

[6] Devroye, L. (2003). Limit laws for sums of functions of subtrees of random binary search trees.

SIAM Journal on Computing, 32, 152171

[7] Feng, Q., Mahmoud, H. and Su, C. (2007). On the variety of subtrees in a random recursive

tree. Technical Report, The George Washington University.

[8] Flajolet, P., Gourdon, X. and Mart nez, C. (1997). Patterns in random binary search trees.

Random Structures and Algorithms, 11, 223244.

[9] Fuchs, M., Hwang, H.-K. and Neininger, R. (2006). Profiles of random trees: Limit theorems

for random recursive trees and binary search trees. Algorithmica, 46, 367407.

[10] Gastwirth, J. and Bhattacharya, P. (1984). Two probability models of pyramids or chain letter
schemes demonstrating that their promotional claims are unreliable. Operations Research,
32, 527536.

[11] Johnson, N. and Kotz, S. (1977). Urn models and Their Applications. Wiley, New York.
[12] Kemp, R. (1984). Fundamentals of the Average Case Analysis of Particular Algorithms. Wiley,

New York.

[13] Knuth, D. (1998). The Art of Computer Programming, Vol. 3: Sorting and Searching, 2nd ed.

Addison-Wesley, Reading, Massachusetts.

[14] Lent, J. and Mahmoud, H. (1996). Average-case analysis of multiple Quickselect: An algorithm

for finding order statistics. Statistics and Probability Letters, 28, 299310.

[15] Mahmoud, H. (1992). Evolution of Random Search Trees. Wiley, New York.
[16] Mahmoud, H. (2000). Sorting: A Distribution Theory. Wiley, New York.
[17] Najock, D. and Heyde, C. (1982). On the number of terminal vertices in certain random trees
with an application to stemma construction in philology. Journal of Applied Probability,
19, 675680.

[18] Neininger, R. (2002). The Wiener index of random trees. Combinatorics, Probability and Com-

puting, 11, 587597.

[19] R osler, U. (1991). A limit theorem for Quicksort. RAIRO Inform. Th eor. Appl., 25, 85100.
[20] R osler, U. and R uschendorf, L. (2001). The contraction method for recursive algorithms. Algo-

rithmica, 29, 333.

[21] Panholzer, A. and Prodinger, H. (1998). A generating functions approach for the analysis of

26

Q. FENG, H. M. MAHMOUD AND A. PANHOLZER

grand averages for multiple QUICKSELECT. Random Structures and Algorithms, 13,
189209.

[22] Smythe, R. and Mahmoud, H. (1994). A survey of recursive trees. Theorya Imovirnosty ta
Matemika Statystika, 51, 129 (in Ukrainian); an English translation appears in Theory
of Probability and Its Applications (1996).

